name: Rclone Transfer OneDrive to WebDAV

# 触发方式：手动 + 定时
on: 
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  rclone-copy:
    runs-on: ubuntu-latest
    
    steps:
    # 1. 安装 Rclone
    - name: Install Rclone
      run: |
        sudo -v ; curl https://rclone.org/install.sh | sudo bash

    # 2. 写入配置文件 (记得你刚才更新了 Secrets 哦！)
    - name: Setup Rclone Config
      run: |
        mkdir -p ~/.config/rclone
        echo "${{ secrets.RCLONE_CONF }}" | base64 -d > ~/.config/rclone/rclone.conf
        # 验证一下
        ls -l ~/.config/rclone/rclone.conf

    # 3. 执行复制任务 (OneDrive -> WebDAV)
    - name: Run Rclone Copy
      run: |
        rclone copy "onedrive:" "6pan:备份" \
          --transfers 2 \
          --checkers 4 \
          --buffer-size 16M \
          --onedrive-chunk-size 60M \
          --ignore-checksum \
          --size-only \
          --timeout 30m \
          --contimeout 30m \
          --tpslimit 2 \
          --user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
          -v
